<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Functional programming in sh</title>
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
  </head>
  <body>
    <div id="main">
      <div id="header">
        <div id="navigation">
          <a class="btn" href="../">Home</a>
          <a class="btn" href="../posts">Posts</a>
          <a class="btn" href="../projects">Projects</a>
          <a class="btn" href="../gallery">Gallery</a>
          <a class="btn" href="../resume.html">Resume</a>
          <a class="btn rss" href="../feed.xml">-</a>
        </div>
        <div id="title">
          <h1>Functional programming in sh</h1>
        </div>
      </div>
      <div id="content">
        <div class="info">
  Posted on May 21, 2012
  
    by Mike Ledger
  
</div>

<h4 id="warning-this-code-is-horribly-broken-outside-of-use-in-zsh.">Warning: this code is horribly broken outside of use in Zsh.</h4>
<h4 id="as-such-all-occurences-of-sh-are-referring-to-posix-shells-ie-bash-and-binsh-which-is-usually-symlinked-to-bash-minus-some-bash-only-features.">As such, all occurences of “sh” are referring to POSIX shells ie bash and /bin/sh, (which is usually symlinked to bash, minus some bash-only features).</h4>
<p>I find myself trying to do things I can do in GHCi more each passing day in my innocent /bin/sh. I find myself seeking a good balance between the numerous layers of hacks that compose shell script and the <em>purely functional wonder</em> of a Haskell program. Such efforts already exist, most recently in <a href="https://github.com/yesodweb/Shelly.hs#readme">Shelly.hs</a>, but I believe this to be tackling the problem from the wrong end. Instead of hacking together a library to make Haskell code reminiscent of the beloved /bin/sh, the problem should be tackled with extreme prejudice by hacking together a sh script to mimic the best of Haskell, and retain the beauty of shell scripts.</p>
<h3 id="the-beauty-of-shell-scripts">The beauty of shell scripts?</h3>
<ul>
<li>Piping</li>
<li>(almost) Painless concurrency</li>
<li>Small overhead (this problem can be alleviated by my efforts, however)</li>
<li>Easy syntax</li>
<li>Simplest type system in the world: everything is a string!
<ul>
<li>If it’s not a string, it’s a dirty lie.</li>
<li>$(( A dirty lie. ))</li>
</ul></li>
</ul>
<h3 id="the-horror-of-shell-scripts">The horror of shell scripts</h3>
<ul>
<li>The type system makes Visual Basic 6 cry.</li>
<li>The type system makes a Haskell programmer spend days in solitude contemplating the purpose of human life.</li>
<li>sh arrays suck
<ul>
<li>They are strings</li>
<li>Sometimes</li>
</ul></li>
<li>sh syntax quickly piles up; leaning pipe syndrome</li>
<li>sh is slow (thanks zsh and dash!)</li>
</ul>
<h3 id="complexity-and-fun-sh-vs-haskell">Complexity and fun: sh vs Haskell</h3>
<p><img class="centre" src="../images/funsh/funsh.png"> When we are compare such vastly different languages as these, you have to remember that they both have extremely different purposes and real world uses. Haskell is an extremely feature rich general purpose programming language. sh is very convenient for simple and mundane tools that are best made by composing other programs together via piping. For those of us who have no idea of what they’re doing 90% of the time when they are using bash (that would be me), there is:</p>
<p><img class="centre" src="../images/funsh/logo.png"></p>
<h3 id="enter-fun.sh">Enter fun.sh</h3>
<p>fun.sh adds some tools seen and used mainly by functional programmers including take, drop, scanl, foldl, map and lambdas. Because sh has no real type system, the convention is to use pipes as you would use lists in Haskell, which allows fun.sh functions to be easily composable via piping.</p>
<p>Anonymous functions in fun.sh are deceptively dumb. fun.sh will simply consume and remember every argument given up until a “.”, “-&gt;”, “→” or “:” is found, then reading each argument before evaluating the body of the function.</p>
<h3 id="a-few-demos">A few demos</h3>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># sum of a bash array</span>
<span class="fu">boring_sum()</span> <span class="kw">{</span>
    <span class="ot">array=</span><span class="st">&quot;</span><span class="ot">$@</span><span class="st">&quot;</span>
    <span class="ot">s=</span>0
    <span class="kw">for</span> <span class="kw">i</span> in <span class="ot">$array</span><span class="kw">;</span> <span class="kw">do</span>
        <span class="ot">s=$(($i</span> + <span class="ot">$s))</span>
    <span class="kw">done</span>
    <span class="kw">echo</span> <span class="ot">$s</span>
<span class="kw">}</span>

<span class="co"># sum of a bash array, piping the array in</span>
<span class="fu">boring_sum_pipe()</span> <span class="kw">{</span>
    <span class="ot">s=</span>0
    <span class="kw">while</span> <span class="kw">read</span> <span class="ot">i</span>; <span class="kw">do</span>
        <span class="ot">s=$(($s</span> + <span class="ot">$i))</span>
    <span class="kw">done</span>
    <span class="kw">echo</span> <span class="ot">$s</span>
<span class="kw">}</span>

<span class="co"># now, with fun.sh</span>

$ <span class="fu">sum()</span><span class="kw">{</span> <span class="kw">foldl</span> λ a b . <span class="st">'echo $(($a + $b))'</span> <span class="kw">}</span> 
$ <span class="kw">list</span> <span class="dt">{1..100}</span> <span class="kw">|</span> <span class="kw">sum</span>
<span class="kw">5050</span>

<span class="co"># and to show off, </span>

$ <span class="fu">product()</span><span class="kw">{</span> <span class="kw">foldl</span> λ a b . <span class="st">'echo $(($a * $b))'</span> <span class="kw">}</span>
$ <span class="kw">list</span> <span class="dt">{1..20}</span> <span class="kw">|</span> <span class="kw">product</span>
<span class="kw">2432902008176640000</span>

$ <span class="fu">factorial()</span><span class="kw">{</span> <span class="kw">list</span> <span class="dt">{1..$1}</span> <span class="kw">|</span> <span class="kw">product</span> <span class="kw">}</span>
$ <span class="kw">factorial</span> 5
<span class="kw">120</span>

$ <span class="fu">foobar()</span><span class="kw">{</span> <span class="kw">product</span> <span class="kw">|</span> λ <span class="kw">l</span> . <span class="st">'list {1..$l}'</span> <span class="kw">|</span> <span class="kw">sum</span> <span class="kw">|</span> <span class="kw">md5sum</span> <span class="kw">}</span>
$ <span class="kw">list</span> <span class="dt">{1,2,3}</span> <span class="kw">|</span> <span class="kw">foobar</span>
<span class="kw">fe9d26c3e620eeb69bd166c8be89fb8f</span>  -

$ <span class="fu">id()</span><span class="kw">{</span> λ <span class="kw">x</span> . <span class="st">'$x'</span> <span class="kw">}</span>
$ <span class="kw">id</span> <span class="kw">&lt;&lt;&lt;</span> <span class="st">'echo :)'</span>
<span class="kw">:</span>)

<span class="co"># Oh no, the boss wants me to calculate the sum of every integer between 400 and 500! Whatever shall I do?!</span>
$ <span class="kw">list</span> <span class="dt">{400..500}</span> <span class="kw">|</span> <span class="kw">foldl</span> λ x y . <span class="st">'echo $(($x + $y))'</span>
<span class="kw">45450</span>
<span class="co"># Thanks fun.sh, I don't know where I would be without you.</span></code></pre></div>
<p><a href="https://github.com/mikeplus64/fun.sh">GitHub project</a>.</p>

<br />

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'quasimal';
  (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>
    </div>
  </body>
</html>
